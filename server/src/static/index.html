<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no,viewport-fit=cover"
  />
  <script src="vue.js"></script>
  <script src="https://unpkg.com/vue@3.2.29/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="previewer/index.css">
  <style>
      html, body {
          height: 100%;
      }

      body {
          display: flex;
      }

      #app {
          flex: 1;
      }

      * {
          margin: 0;
          padding: 0;
      }
  </style>
  <title>Title</title>
  <script>
    //设置根节点font-size
    (function(doc, win) {
      var docEl = doc.documentElement,
        resizeEvt = "orientationchange" in window ? "orientationchange" : "resize",
        recalc = function() {
          var rem = docEl.clientWidth / 10;
          if (!rem) return;
          docEl.style.fontSize = rem + "px";
        };
      recalc();
      if (!doc.addEventListener) return;
      win.addEventListener(resizeEvt, recalc, false); //窗体大小发生改变时
      doc.addEventListener("DOMContentLoaded", recalc, false);//文档重载时
    })(document, window);
  </script>
</head>
<body>
<div id="app">
  <previewer :pages="page" v-if="page.length>0" />
</div>
</body>
<script>
  let id = location.search.match(/id=([^&]*)/);
  if (id) {
    id = id[1];
  }
  const { ref } = Vue;
  const app = Vue.createApp({
    setup() {
      const page = ref([]);
      if (!id) {
        alert("未传入文档id");
        return false;
      }
      fetch(`http://10.0.233.21:3000/api/document/${id}`).then(res => res.json()).then(res => {
        if (res.code === 200) {
          const { content } = res.data;
          if (!content) {
            alert("不存在的文档");
            return;
          }

          page.value = content.pages;
        } else {
          alert(res.message);
        }
      });
      return {
        page
      };
    }
  });
  app.use(previewer);
  app.mount("#app");
</script>
</html>
